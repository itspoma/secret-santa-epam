// Generated by CoffeeScript 1.10.0
(function() {
  var ajax;

  ajax = function(url, data, done) {
    var getXmlHttp, xmlhttp;
    getXmlHttp = function() {
      var E, e, error, error1, xmlhttp;
      try {
        return xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
      } catch (error) {
        e = error;
        try {
          xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        } catch (error1) {
          E = error1;
          xmlhttp = false;
        }
        if (!xmlhttp && typeof XMLHttpRequest !== 'undefined') {
          xmlhttp = new XMLHttpRequest();
        }
        return xmlhttp;
      }
    };
    xmlhttp = getXmlHttp();
    if (data) {
      xmlhttp.open('POST', url, true);
    } else {
      xmlhttp.open('POST', url, true);
    }
    xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState !== 4) {
        return;
      }
      if (xmlhttp.status === 200) {
        return typeof done === "function" ? done(xmlhttp.responseText) : void 0;
      } else {
        return handleError(xmlhttp.statusText);
      }
    };
    return xmlhttp.send(data);
  };

  window.proceed = function() {
    var email, emailEl, errorEl, formEl, isAgreementChecked;
    formEl = document.getElementById('form-initial');
    errorEl = document.getElementById('form-error');
    emailEl = document.getElementsByName('email')[0];
    email = emailEl.value;
    isAgreementChecked = document.getElementsByName('agreement')[0].checked;
    if (!isAgreementChecked) {
      errorEl.innerHTML = 'Треба прийняти умови, щоб прийняти участь у грі!';
      return false;
    }
    if (!email.length) {
      errorEl.innerHTML = 'Ви забули ввести емейл!';
      emailEl.focus();
      return false;
    }
    if (!/^.+?@.+?\.\w{2,}$/.test(email)) {
      errorEl.innerHTML = 'Введіть коректний емейл!';
      emailEl.focus();
      return false;
    }
    if (!/@epam\.com$/.test(email)) {
      errorEl.innerHTML = 'Гра тільки для працівників фірми EPAM!\nВведіть ваш @epam емейл.';
      emailEl.focus();
      return false;
    }
    formEl.classList.add('loading');
    ajax('/play', 'email=' + email, function(data) {
      formEl.classList.remove('loading');
      formEl.classList.add('hidden');
      return document.getElementById('form-initial-after').classList.remove('hidden');
    });
    return false;
  };

}).call(this);
